# rage_task:
#     type: task
#     script:
    


rage_command:
    type: command
    name: rage
    script:
    - if <player.has_flag[skill.specializations.rage.level]> && <player.flag[skill.specializations.rage.level]> > 0:
        
        - if <player.has_flag[stat.status.buff.rage]>:
            - flag <player> stat.status.buff.rage:!
            # - flag <player> stat.status.buff.rage.level:2
            - narrate "Rage off"
            - flag <player> skill.attribute.intelligence.level:<player.flag[temp.stat.core.intelligence.level]||10>
        - else:
            - if <proc[equipment_size_proc].context[<player>]>:
                - flag <player> stat.status.buff.rage
                - flag <player> temp.stat.core.intelligence.level:<player.flag[skill.attribute.intelligence.level]||1>
                - flag <player> skill.attribute.intelligence.level:0
                - narrate "Rage on"
            - else:
                - narrate "You can't reach Rage while wearing armor." targets:<player>
    - else:
        - narrate "You don't have Rage." targets:<player>


rage_counter:
    type: world
    debug: false
    events:
        on delta time secondly every:10:
        - foreach <server.online_players_flagged[stat.status.buff.rage]> as:rage_player:
            - narrate "rage tick down" targets:<[rage_player]>
            - if <[rage_player].flag[stat.status.buff.rage.level]> > 0 && <proc[equipment_size_proc].context[<[rage_player]>]>:
                - flag <[rage_player]> stat.status.buff.rage.level:--
                - narrate "rage goes down to <[rage_player].flag[stat.status.buff.rage.level]>" targets:<[rage_player]>
            - else:
                - flag <[rage_player]> stat.status.buff.rage:!
                - narrate "rage off" targets:<[rage_player]>
                - flag <[rage_player]> skill.attribute.intelligence.level:<[rage_player].flag[temp.stat.core.intelligence.level]>
            - wait <[rage_player].flag[skill.specializations.rage.level]||1>s
    
