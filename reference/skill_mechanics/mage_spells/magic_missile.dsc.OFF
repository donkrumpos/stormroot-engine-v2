magic_missile_task:
    type: task
    definitions: attacker|target
    script:
    - if <[target].is_living>:
        - playsound <player.location> sound:steamfront:spells.magicmissile custom sound_category:players
    # - playeffect <player.location.right[1].forward[2]> effect:red_dust special_data:1|#fdff99 quantity:10 
    # - playeffect <player.location.right[1].forward[2]> effect:red_dust special_data:1|#dbb0d4 quantity:4
    # - shoot <item[carrot_on_a_stick].with[custom_item_data=16802]> origin:<[attacker]> destination:<[attacker].precise_target>
    - shoot snowball[item=magic_missile_entity_item] origin:<[attacker].eye_location.backward[3]>  shooter:<[attacker]> no_rotate speed:2 save:magic_missile spread:8 script:magic_missile_land_task
    - wait 2t
    - repeat 30:
        - define location <entry[magic_missile].shot_entity.location>
# - foreach <[attacker].eye_location.points_between[<[attacker].cursor_on>]> as:point:
        - run magic_missile_particle_task def:<[location]>
        - wait 1t
        - run magic_missile_particle_task def:<[location]>
    # - foreach <player.eye_location.right[1].points_between[<player.cursor_on>]> as:point:

magic_missile_particle_task:
    type: task
    definitions: location
    script:
    - playeffect effect:red_dust special_data:1|#fdff99 at:<[location]> quantity:30 offset:0
    - playeffect effect:red_dust special_data:1|#dbb0d4 at:<[location]> quantity:10 offset:0
    
    
    


magic_missile_land_task:
    type: task
    script:
    # - foreach <player.eye_location.right[1].points_between[<player.cursor_on>]> as:point:
        # - wait 1t
        # - narrate <[point]>
        # - playereffect effect:FIREWORKS_SPARK at:<[point]> quantity:100
    
    - foreach <[hit_entities]> as:entity:
        - if <[target].exists>:
            - playsound <[entity]> sound:steamfront:spells.magicmissile custom sound_category:players
        - if <[entity].is_player.not>:
            - hurt 1 <[entity]>
        - run spell_damage_task def:MagicMissile|<[entity]>|<player>
        
        - playeffect at:<[entity].location>  effect:red_dust special_data:1|#fdff99 quantity:10 
        - playeffect at:<[entity].location>  effect:red_dust special_data:1|#dbb0d4 quantity:3
        - if <util.random.int[1].to[100]> == 100:
            - playeffect effect:explosion at:<[entity].location> visibility:100
            - push <[entity]> destination:<[entity].location.up[5]>